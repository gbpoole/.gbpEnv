# This configuration was taken from here:
#    https://github.com/hamvocke/dotfiles
#
# and is described in the post here:
#    https://www.hamvocke.com/blog/a-guide-to-customizing-your-tmux-conf/
#

# change the prefix from 'C-b' to 'C-a'
# (remap capslock to CTRL for easy access)
unbind C-b
set-option -g prefix C-a
bind-key C-a send-prefix

## start with window 1 (instead of 0)
#set -g base-index 1
#
## start with pane 1
#set -g pane-base-index 1

# split panes using | and -, make sure they open in the same path
unbind '"'
unbind %
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"

# open new windows in the current path
bind c new-window -c "#{pane_current_path}"

# reload config file
bind r source-file ~/.tmux.conf

# Previous window
unbind p
bind p previous-window

# shorten command delay
set -sg escape-time 1

# don't rename windows automatically
set-option -g allow-rename off

# mouse control (clickable windows, panes, resizable panes)
# don't like what this does to text selection.  Alternatively, 
# turn back on and hold <option> to select
#set -g mouse on

# Use Alt-arrow keys without prefix key to switch panes
bind -n M-Left select-pane -L
bind -n M-Right select-pane -R
bind -n M-Up select-pane -U
bind -n M-Down select-pane -D

# enable vi mode keys
set-window-option -g mode-keys vi

# set default terminal mode to 256 colors
set -g default-terminal "screen-256color"

# fix pbcopy/pbpaste
if 'command -v reattach-to-user-namespace >/dev/null' \
    'set -gq @osx-pasteboard true'

if 'tmux show -gv @osx-clipboard' \
    'set -g default-command "reattach-to-user-namespace -l $SHELL"'

######################
### DESIGN CHANGES ###
######################

# loud or quiet?
set-option -g visual-activity off
set-option -g visual-bell off
set-option -g visual-silence off
set-window-option -g monitor-activity off
set-option -g bell-action none

# Set-up the status bar
source-file $GBP_HOME/.tmux-molokai.conf

###############
### PLUGINS ###
###############
set -g @plugin 'tmux-plugins/tpm'
set -g @plugin 'tmux-plugins/tmux-sensible'
set -g @plugin 'tmux-plugins/vim-tmux'
set -g @plugin 'tmux-plugins/tmux-prefix-highlight'
set -g @plugin 'tmux-plugins/tmux-yank'
set -g @plugin 'nhdaly/tmux-better-mouse-mode'

# Resurrect & Continuum (note: interval is in mins)
set -g @plugin 'tmux-plugins/tmux-resurrect'
set -g @plugin 'tmux-plugins/tmux-continuum'
set -g @continuum-restore 'on'
set -g @continuum-save-interval '720'

# Sessionist
#
#    prefix + g - prompts for session name and switches to it. Performs 'kind-of' name completion.
#                 Faster than the built-in prefix + s prompt for long session lists.
#    prefix + C (shift + c) - prompt for creating a new session by name.
#    prefix + X (shift + x) - kill current session without detaching tmux.
#    prefix + S (shift + s) - switches to the last session.
#                             The same as built-in prefix + L that everyone seems to override with some other binding.
#    prefix + @ - promote current pane into a new session.
#                 Analogous to how prefix + ! breaks current pane to a new window.
#    prefix + t<secondary-key> - join currently marked pane (prefix + m) to current session/window, and switch to it
#        secondary-keys
#            h, -, ": join horizontally
#            v, |, %: join vertically
#            f, @: join full screen
set -g @plugin 'tmux-plugins/tmux-sessionist'

# Pain control
#
# Navigation
#    prefix + h and prefix + C-h
#        select pane on the left
#    prefix + j and prefix + C-j
#        select pane below the current one
#    prefix + k and prefix + C-k
#        select pane above
#    prefix + l and prefix + C-l
#        select pane on the right
#
# Resizing
#    prefix + shift + h
#        resize current pane 5 cells to the left
#    prefix + shift + j
#        resize 5 cells in the down direction
#    prefix + shift + k
#        resize 5 cells in the up direction
#    prefix + shift + l
#        resize 5 cells to the right
#
# Splitting
#    prefix + |
#        split current pane horizontally
#    prefix + -
#        split current pane vertically
#    prefix + \
#        split current pane full width horizontally
#    prefix + _
#        split current pane full width vertically
#
# Swapping windows
#    prefix + < - moves current window one position to the left
#    prefix + > - moves current window one position to the right
set -g @plugin 'tmux-plugins/tmux-pain-control'

# Activate mouse control
set-option -g mouse on

# Make sure TPM is installed
if "test ! -d ~/.tmux/plugins/tpm" \
   "run 'git clone https://github.com/tmux-plugins/tpm ~/.tmux/plugins/tpm && ~/.tmux/plugins/tpm/bin/install_plugins'"

# Initialize TMUX plugin manager (keep this line at the very bottom of .tmux.conf)
run -b '~/.tmux/plugins/tpm/tpm'

